# 开发指南

## 代码质量要求

在提交代码之前，所有代码都必须通过预提交检查。你可以通过以下两种方式运行检查：

1. 使用预提交钩子（自动）：
   - 当你执行 `git commit` 时，预提交钩子会自动运行
   - 如果检查失败，提交将被阻止

2. 手动运行检查：
   ```bash
   ./check.sh
   ```

### 检查项目

代码必须通过以下所有检查才能提交：

1. **代码格式化 (black)**
   - 所有 Python 代码必须符合 black 格式化标准
   - 最大行长度：100 字符
   - 使用 `black .` 可以自动格式化代码

2. **代码质量 (pylint)**
   - 代码质量分数必须达到 10/10
   - 主要检查项目：
     - 命名规范
     - 代码复杂度
     - 代码结构
     - 异常处理
     - 导入顺序
   - 特殊规则可以在 `.pylintrc` 中配置

3. **单元测试 (pytest)**
   - 所有测试必须通过
   - 测试覆盖率要求：
     - 总体覆盖率不低于 70%
   - 测试原则：
     - 优先使用验收测试
     - 尽量避免过度使用 mock
     - 测试应该关注功能而不是实现细节

### 最佳实践

1. **代码组织**
   - 使用清晰的目录结构
   - 保持模块的单一职责
   - 将实现和测试代码分开放置

2. **版本控制**
   - 提交信息要清晰明了
   - 每个提交只做一件事
   - 保持提交粒度适中

3. **文档**
   - 为所有公共 API 提供文档字符串
   - 保持注释的及时性和准确性
   - 使用清晰的变量和函数命名

### 开发流程

1. 编写代码前：
   - 理解需求
   - 设计接口
   - 规划测试用例

2. 编写代码时：
   - 遵循 Python 编码规范
   - 编写测试
   - 及时运行检查脚本

3. 提交代码前：
   - 运行 `./check.sh` 确保所有检查通过
   - 检查文档是否更新
   - 确保提交信息符合规范

### 常见问题解决

1. black 格式化失败：
   ```bash
   black .
   ```

2. pylint 警告：
   - 检查 `.pylintrc` 中的规则
   - 必要时添加行内注释禁用特定警告

3. 测试失败：
   - 检查测试输出了解具体失败原因
   - 确保测试环境正确设置
   - 验证测试数据的有效性 